<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Stuff4U</title>
    <link rel="stylesheet" href="home.css">
</head>

<body>
    <!-- Navigation Bar -->
    <header class="header">
        <div class="header-container">
            <div class="header-top-row">
                <div class="logo">
                    <div class="eagle-logo"><img class="logomain" src="ps/logo.avif" alt="Premium Stuff4U Logo"></div>
                </div>
                <div class="brand-title">PREMIUM STUFF4U</div>
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle navigation menu">
                    <span class="hamburger-icon">☰</span>
                    <span class="close-icon" style="display: none;">×</span>
                </button>
            </div>
            <div class="search-container">
                <input type="text" class="search-box" placeholder="SEARCH HERE" aria-label="Search products">
            </div>
            <nav class="nav-menu" id="navMenu">
                <button class="nav-item active" data-href="/">HOME</button>
                <div class="nav-item shop" id="shopItem">
                    SHOP
                    <div class="dropdown">
                        <a href="/shop" class="dropdown-item">Shop All</a>
                        <a href="/iptv" class="dropdown-item">IPTV</a>
                        <a href="/career-growth" class="dropdown-item">Career Growth</a>
                        <a href="/streaming" class="dropdown-item">Streaming</a>
                        <a href="/social-media" class="dropdown-item">Social Media</a>
                        <a href="/designing" class="dropdown-item">Designing</a>
                        <a href="/other-utilities" class="dropdown-item">Other Utilities</a>
                        <a href="/refer-friends" class="dropdown-item">Refer Friends</a>
                    </div>
                </div>
                <button class="nav-item" data-href="/faq">FAQ</button>
                <div class="nav-item more" id="moreItem">
                    MORE
                    <div class="dropdown">
                        <a href="/contact-us" class="dropdown-item">Contact Us</a>
                        <a href="/our-story" class="dropdown-item">Our Story</a>
                    </div>
                </div>
                <button class="nav-item" data-href="/cart">Cart</button>
            </nav>
        </div>
    </header>

    <!-- Social Icons -->
    <div class="social-icons">
        <a href="#" class="social-icon whatsapp-icon" id="whatsapp-link" target="_blank" aria-label="WhatsApp">
            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Icon">
        </a>
        <a href="#" class="social-icon facebook-icon" id="facebook-link" target="_blank" aria-label="Facebook">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"
                alt="Facebook Icon">
        </a>
        <a href="#" class="social-icon instagram-icon" id="instagram-link" target="_blank" aria-label="Instagram">
            <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram Icon">
        </a>
        <a href="#" class="social-icon telegram-icon" id="telegram-link" target="_blank" aria-label="Telegram">
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Icon">
        </a>
    </div>

    <!-- Banner Section -->
    <section class="banner-section">
        <div class="banner-container">
            <img src="ps/freetrail.jpg" alt="Premium Banner" class="banner-image">
            <div class="banner-buttons">
                <a href="#" class="banner-btn banner-btn-left"  target="_blank" >Free Trial</a>
                <a href="#" class="banner-btn banner-btn-right" target="_blank" >Free Trial</a>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <h1 class="section-title">BEST SELLING</h1>

        <!-- Product Grid -->
        <div class="product-grid" id="product-grid"></div>

        <!-- Modal for Product Details -->
        <div id="cart-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-modal">×</span>
                <div class="modal-product">
                    <img class="modal-product-image" src="" alt="Product Image">
                    <div class="modal-details">
                        <h3 class="modal-product-title"></h3>
                        <div class="modal-price-container">
                            <span class="modal-product-price"></span>
                            <select class="modal-validity-dropdown"></select>
                        </div>
                        <div class="modal-quantity-container">
                            <button class="quantity-btn decrease">-</button>
                            <span class="modal-quantity">1</span>
                            <button class="quantity-btn increase">+</button>
                        </div>
                        <button class="add-to-cart-confirm">Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- WHAT THEY SAY Section -->
        <section class="testimonials-section">
            <h2 class="section-title">WHAT THEY SAY</h2>
            <div class="carousel-container">
                <button class="carousel-prev">❮</button>
                <div class="carousel" id="testimonial-carousel"></div>
                <button class="carousel-next">❯</button>
            </div>
        </section>

        <!-- Community and Highlights Section -->
        <section class="community-highlights-section">
            <h2 class="community-title">Join the PREMIUM STUFF 4u Community</h2>
            <div class="community-social">
                <a href="#" class="community-icon community-whatsapp" id="community-whatsapp-link" target="_blank"
                    aria-label="WhatsApp Community">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Logo">
                </a>
                <a href="#" class="community-icon community-facebook" id="community-facebook-link" target="_blank"
                    aria-label="Facebook Community">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg"
                        alt="Facebook Logo">
                </a>
                <a href="#" class="community-icon community-instagram" id="community-instagram-link" target="_blank"
                    aria-label="Instagram Community">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png"
                        alt="Instagram Icon">
                </a>
                <a href="#" class="community-icon community-telegram" id="community-telegram-link" target="_blank"
                    aria-label="Telegram Community">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg"
                        alt="Telegram Icon">
                </a>
            </div>
        </section>

        <!-- New Slider Section -->
        <section class="slider-section">
            <div class="slider-container">
                <button class="slider-prev">❮</button>
                <div class="slider">
                    <div class="slide">
                        <div class="vector-art money-art-1"></div>
                        <p class="slide-text">Affordable Deals Starting at $3!</p>
                    </div>
                    <div class="slide">
                        <div class="vector-art money-art-2"></div>
                        <p class="slide-text">Low-Cost Offers for You!</p>
                    </div>
                    <div class="slide">
                        <div class="vector-art support-art-1"></div>
                        <p class="slide-text">24/7 Support Always Available</p>
                    </div>
                    <div class="slide">
                        <div class="vector-art support-art-2"></div>
                        <p class="slide-text">Nonstop Assistance Anytime!</p>
                    </div>
                </div>
                <button class="slider-next">❯</button>
            </div>
        </section>

        <!-- Uncover Categories Section -->
        <section class="categories-section">
            <h2 class="section-title">Uncover our categories</h2>
            <div class="categories-grid">
                <div class="category-card iptv-4k" data-href="/iptv">
                    <div class="category-icon"><img src="ps/iptv.png" alt="IPTV 4K Icon"></div>
                    <h3 class="category-title">IPTV 4K</h3>
                </div>
                <div class="category-card career-growth-cat" data-href="/career-growth">
                    <div class="category-icon"><img src="ps/careergrowth.png" alt="Career Growth Icon"></div>
                    <h3 class="category-title">Career Growth</h3>
                </div>
                <div class="category-card streaming-cat" data-href="/streaming">
                    <div class="category-icon"><img src="ps/streaming.jpg" alt="Streaming Icon"></div>
                    <h3 class="category-title">Streaming</h3>
                </div>
                <div class="category-card social-media-cat" data-href="/social-media">
                    <div class="category-icon"><img src="ps/social media.png" alt="Social Media Icon"></div>
                    <h3 class="category-title">Social Media</h3>
                </div>
                <div class="category-card designing-cat" data-href="/designing">
                    <div class="category-icon"><img src="ps/creativity.png" alt="Designing Icon"></div>
                    <h3 class="category-title">Designing</h3>
                </div>
                <div class="category-card utilities-cat" data-href="/other-utilities">
                    <div class="category-icon"><img src="ps/utilities.png" alt="Other Utilities Icon"></div>
                    <h3 class="category-title">Other Utilities</h3>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="newsletter-box">
                <h3 class="newsletter-title">JOIN OUR NEWSLETTER</h3>
                <input type="email" class="newsletter-input" placeholder="Enter your email here"
                    aria-label="Newsletter email">
                <button class="subscribe-btn">SUBSCRIBE NOW</button>
            </div>
            <div class="footer-divider"></div>
            <div class="footer-links">
                <a href="/contact-us" class="footer-link">Contact Us</a>
                <a href="/faq" class="footer-link">Frequently Asked Questions</a>
            </div>
        </div>
        <div class="copyright">© 2025 BY PREMIUM STUFF</div>
    </footer>

    <script>
let sessionId = null;

const priceFieldMap = {
    '$': 'usa',
    'C$': 'canada',
    '£': 'uk',
    '₹': 'india',
    'NZ$': 'nz',
    'A$': 'aus'
};

async function fetchSessionId() {
    try {
        const response = await fetch('/api/session-id', {
            headers: { 'Content-Type': 'application/json' }
        });
        if (response.ok) {
            const data = await response.json();
            sessionId = data.sessionId;
        } else {
            console.error('Failed to fetch session ID:', await response.text());
            sessionId = 'default-session';
        }
    } catch (error) {
        console.error('Error fetching session ID:', error);
        sessionId = 'default-session';
    }
}

async function fetchSocialLinks() {
    try {
        const response = await fetch('/api/links', {
            headers: { 'Content-Type': 'application/json' }
        });
        if (!response.ok) throw new Error('Failed to fetch social links');
        const links = await response.json();
        updateSocialLinks(links, 'social');
    } catch (error) {
        console.error('Error fetching social links:', error);
        updateSocialLinks([
            { name: 'WhatsApp', url: 'https://wa.me/' },
            { name: 'Facebook', url: 'https://facebook.com/' },
            { name: 'Instagram', url: 'https://instagram.com/' },
            { name: 'Telegram', url: 'https://t.me/' }
        ], 'social');
    }
}

async function fetchCommunityLinks() {
    try {
        const response = await fetch('/api/communitylinks/public', {
            headers: { 'Content-Type': 'application/json' }
        });
        if (!response.ok) throw new Error('Failed to fetch community links');
        const links = await response.json();
        updateSocialLinks(links, 'community');
    } catch (error) {
        console.error('Error fetching community links:', error);
        updateSocialLinks([
            { name: 'WhatsApp', url: 'https://wa.me/' },
            { name: 'Facebook', url: 'https://facebook.com/' },
            { name: 'Instagram', url: 'https://instagram.com/' },
            { name: 'Telegram', url: 'https://t.me/' }
        ], 'community');
    }
}

function updateSocialLinks(links, type) {
    const linkMap = links.reduce((acc, link) => {
        acc[link.name.toLowerCase()] = link.url || '#';
        return acc;
    }, {});
    if (type === 'social') {
        document.getElementById('whatsapp-link').href = linkMap['whatsapp'] || '#';
        document.getElementById('facebook-link').href = linkMap['facebook'] || '#';
        document.getElementById('instagram-link').href = linkMap['instagram'] || '#';
        document.getElementById('telegram-link').href = linkMap['telegram'] || '#';
    } else if (type === 'community') {
        document.getElementById('community-whatsapp-link').href = linkMap['whatsapp'] || '#';
        document.getElementById('community-facebook-link').href = linkMap['facebook'] || '#';
        document.getElementById('community-instagram-link').href = linkMap['instagram'] || '#';
        document.getElementById('community-telegram-link').href = linkMap['telegram'] || '#';
    }
}

async function fetchFreeTrialLinks() {
    console.log('Starting fetchFreeTrialLinks execution'); // Debugging
    try {
        const response = await fetch('/api/freetriallinks/public', {
            headers: { 'Content-Type': 'application/json' }
        });
        console.log('Fetching free trial links from /api/freetriallinks/public'); // Debugging
        if (!response.ok) {
            const errorText = await response.text();
            console.error('Fetch failed with status:', response.status, response.statusText, 'Response:', errorText);
            throw new Error('Failed to fetch free trial links');
        }
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            const text = await response.text();
            console.error('Non-JSON response received:', text);
            throw new Error('Received non-JSON response');
        }
        const links = await response.json();
        console.log('Fetched free trial links:', links); // Debugging
        if (links.length === 0) {
            console.warn('No free trial links found in response');
        }
        if (!links.some(link => link.name.toLowerCase() === 'link 1') || !links.some(link => link.name.toLowerCase() === 'link 2')) {
            console.warn('Expected links (link 1, link 2) not found in response:', links);
        }
        updateFreeTrialLinks(links);
    } catch (error) {
        console.error('Error fetching free trial links:', error.message); // Enhanced error logging
        updateFreeTrialLinks([
            { name: 'link 1', url: 'https://whatsapp.com/' }, // Fallback to known DB values
            { name: 'link 2', url: 'https://telegram.com' }
        ]);
    }
}

function updateFreeTrialLinks(links) {
    console.log('Starting updateFreeTrialLinks with links:', links); // Debugging
    const linkMap = links.reduce((acc, link) => {
        acc[link.name.toLowerCase()] = link.url || '#';
        return acc;
    }, {});
    console.log('Free trial linkMap:', linkMap); // Debugging
    const leftButton = document.querySelector('.banner-btn-left');
    const rightButton = document.querySelector('.banner-btn-right');
    if (!leftButton || !rightButton) {
        console.error('Banner buttons not found:', { leftButton, rightButton }); // Debugging
        return;
    }
    leftButton.href = linkMap['link 1'] || '#';
    rightButton.href = linkMap['link 2'] || '#';
    console.log('Set banner-btn-left href:', leftButton.href); // Debugging
    console.log('Set banner-btn-right href:', rightButton.href); // Debugging
}

async function fetchTestimonialImages() {
    try {
        const response = await fetch('/api/testimonials', {
            headers: { 'Content-Type': 'application/json' }
        });
        if (!response.ok) throw new Error('Failed to fetch testimonial images');
        const images = await response.json();
        renderTestimonialImages(images);
    } catch (error) {
        console.error('Error fetching testimonial images:', error);
        renderTestimonialImages([
            'ss/ss1.png',
            'ss/ss2.png',
            'ss/ss3.jpg',
            'ss/ss4.jpg',
            'ss/ss5.jpg',
            'ss/ss6.jpg'
        ]);
    }
}

function renderTestimonialImages(images) {
    const carousel = document.getElementById('testimonial-carousel');
    carousel.innerHTML = '';
    images.forEach((image, index) => {
        const imgElement = document.createElement('img');
        imgElement.src = image;
        imgElement.alt = `Testimonial ${index + 1}`;
        imgElement.className = 'carousel-item';
        carousel.appendChild(imgElement);
    });
    initializeCarousel();
}

function initializeCarousel() {
    const carousel = document.querySelector('.carousel');
    const items = document.querySelectorAll('.carousel-item');
    const totalItems = items.length;
    let visibleItems = window.innerWidth <= 576 ? 2 : 4;
    const itemWidth = 100 / visibleItems;

    carousel.style.width = `${totalItems * (100 / visibleItems)}%`;
    items.forEach(item => {
        item.style.width = `${itemWidth}%`;
    });

    let currentIndex = 0;

    function updateCarousel() {
        const offset = -currentIndex * (100 / visibleItems);
        carousel.style.transform = `translateX(${offset}%)`;
    }

    function updateCarouselLayout() {
        visibleItems = window.innerWidth <= 576 ? 2 : 4;
        carousel.style.width = `${totalItems * (100 / visibleItems)}%`;
        items.forEach(item => {
            item.style.width = `${100 / visibleItems}%`;
        });
        if (currentIndex > totalItems - visibleItems) {
            currentIndex = totalItems - visibleItems;
            if (currentIndex < 0) currentIndex = 0;
        }
        updateCarousel();
    }

    document.querySelector('.carousel-prev').addEventListener('click', () => {
        if (currentIndex > 0) {
            currentIndex--;
            updateCarousel();
            resetTimer();
        }
    });

    document.querySelector('.carousel-next').addEventListener('click', () => {
        if (currentIndex < totalItems - visibleItems) {
            currentIndex++;
            updateCarousel();
            resetTimer();
        }
    });

    let autoSlideTimer;
    function startTimer() {
        autoSlideTimer = setInterval(() => {
            if (currentIndex < totalItems - visibleItems) {
                currentIndex++;
            } else {
                currentIndex = 0;
            }
            updateCarousel();
        }, 5000);
    }

    function resetTimer() {
        clearInterval(autoSlideTimer);
        startTimer();
    }

    updateCarouselLayout();
    window.addEventListener('resize', updateCarouselLayout);
    startTimer();

    document.querySelector('.carousel-container').addEventListener('mouseover', () => clearInterval(autoSlideTimer));
    document.querySelector('.carousel-container').addEventListener('mouseout', startTimer);
}

async function fetchBestSellers() {
    try {
        const response = await fetch('/api/best-sellers', {
            headers: { 'Content-Type': 'application/json' }
        });
        if (!response.ok) {
            const text = await response.text();
            console.error('Non-OK response:', response.status, text);
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            const text = await response.text();
            console.error('Non-JSON response:', text);
            throw new Error('Received non-JSON response');
        }
        const products = await response.json();
        if (products.length === 0) {
            throw new Error('No best-selling products found');
        }
        renderBestSellers(products);
    } catch (error) {
        console.error('Error fetching best sellers:', error);
        document.getElementById('product-grid').innerHTML = '<p>Error loading best sellers. Please try again later.</p>';
    }
}

function renderBestSellers(products) {
    const grid = document.getElementById('product-grid');
    grid.innerHTML = '';
    products.forEach(product => {
        const nameMap = {
            'iptv': 'IPTV',
            'youtube-premium': 'Youtube Premium',
            'linkedin-premium': 'LinkedIn Premium',
            'spotify-premium': 'Spotify Premium',
            'canva-pro': 'Canva Pro',
            'instagram-followers': 'Instagram followers',
            'nord-vpn': 'Nord VPN'
        };
        const displayName = nameMap[product.name.toLowerCase()] || product.name;
        const urlName = displayName;

        const card = document.createElement('div');
        card.className = `product-card ${urlName.toLowerCase().replace(/\s+/g, '-')}-card`;
        card.dataset.validities = product.available_validities.join(',');
        card.dataset.prices = JSON.stringify(product.prices || {});
        card.dataset.currency = product.currency;
        card.innerHTML = `
            <div class="best-seller-badge">Best Seller</div>
            <a href="/product/${encodeURIComponent(urlName)}" class="product-link">
                <div class="product-icon"><img src="${product.imagepath || 'ps/placeholder.png'}" alt="${displayName} Icon" class="product-image"></div>
            </a>
            <h3 class="product-title">${displayName}</h3>
            <p class="product-price" aria-label="Price ${product.currency}${product.display_price}">${product.currency}${product.display_price}</p>
            <button class="add-to-cart-btn">Add to Cart</button>
        `;
        grid.appendChild(card);
    });
    setupModalListeners();
}

function setupModalListeners() {
    const modal = document.getElementById('cart-modal');
    if (!modal) return;

    const modalImage = modal.querySelector('.modal-product-image');
    const modalTitle = modal.querySelector('.modal-product-title');
    const modalPrice = modal.querySelector('.modal-product-price');
    const modalValidity = modal.querySelector('.modal-validity-dropdown');
    const modalQuantity = modal.querySelector('.modal-quantity');
    const decreaseBtn = modal.querySelector('.decrease');
    const increaseBtn = modal.querySelector('.increase');
    const confirmButton = modal.querySelector('.add-to-cart-confirm');
    const closeButton = modal.querySelector('.close-modal');

    let currentQuantity = 1;
    let currentValidityOptions = [];
    let currentCurrency = '';
    let currentBasePrice = 0;
    let currentPrices = {};

    const updatePriceDisplay = () => {
        const selectedValidity = modalValidity.value;
        const priceField = priceFieldMap[currentCurrency] || 'usa';
        const basePrice = currentPrices[selectedValidity]?.[priceField] || currentBasePrice;
        const totalPrice = basePrice * currentQuantity;
        modalPrice.textContent = `${currentCurrency}${totalPrice.toFixed(2)}`;
    };

    const setupQuantityControls = () => {
        decreaseBtn.addEventListener('click', () => {
            if (currentQuantity > 1) {
                currentQuantity--;
                modalQuantity.textContent = currentQuantity;
                updatePriceDisplay();
            }
        });

        increaseBtn.addEventListener('click', () => {
            currentQuantity++;
            modalQuantity.textContent = currentQuantity;
            updatePriceDisplay();
        });
    };

    const setupValidityChangeHandler = () => {
        modalValidity.addEventListener('change', updatePriceDisplay);
    };

    const setupConfirmButton = () => {
        confirmButton.addEventListener('click', async () => {
            const selectedValidity = modalValidity.value;
            const price = parseFloat(modalPrice.textContent.replace(currentCurrency, ''));

            try {
                const response = await fetch('/api/cart', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        sessionId: sessionId,
                        productName: modalTitle.textContent,
                        validity: selectedValidity,
                        quantity: currentQuantity,
                        price: price,
                        currency: currentCurrency
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to add to cart');
                }

                const data = await response.json();
                console.log('Added to cart:', data);
                showSuccessModal(modalTitle.textContent, currentQuantity, price, currentCurrency, 'New item added to cart');
                closeModal();
            } catch (error) {
                console.error('Error adding to cart:', error);
                alert('Failed to add product to cart. Please try again.');
            }
        });
    };

    const closeModal = () => {
        modal.style.display = 'none';
        resetModalState();
    };

    const resetModalState = () => {
        currentQuantity = 1;
        modalQuantity.textContent = currentQuantity;
        if (currentValidityOptions.length > 0) {
            modalValidity.value = currentValidityOptions[0];
        }
        updatePriceDisplay();
    };

    function showSuccessModal(title, quantity, price, currency, message) {
        const successModal = document.createElement('div');
        successModal.className = 'success-modal';
        successModal.innerHTML = `
            <div class="success-modal-content">
                <span class="success-modal-close">×</span>
                <p>${message.includes('updated') ? 'Quantity updated for' : 'Product'} <strong>${title}</strong> 
                   (x${quantity} at ${currency}${price.toFixed(2)}) ${message}! 
                   <a href="/cart">View Cart</a></p>
            </div>
        `;
        document.body.appendChild(successModal);

        successModal.style.position = 'fixed';
        successModal.style.top = '50%';
        successModal.style.left = '50%';
        successModal.style.transform = 'translate(-50%, -50%)';
        successModal.style.background = 'rgba(0, 0, 0, 0.5)';
        successModal.style.zIndex = '1001';
        successModal.querySelector('.success-modal-content').style.background = '#FFFFFF';
        successModal.querySelector('.success-modal-content').style.padding = '15px';
        successModal.querySelector('.success-modal-content').style.borderRadius = '10px';
        successModal.querySelector('.success-modal-content').style.textAlign = 'center';
        successModal.querySelector('.success-modal-content').style.maxWidth = '300px';

        successModal.querySelector('.success-modal-close').addEventListener('click', () => {
            document.body.removeChild(successModal);
        });
        setTimeout(() => {
            if (successModal.parentNode) {
                document.body.removeChild(successModal);
            }
        }, 3000);
    }

    setupQuantityControls();
    setupValidityChangeHandler();
    setupConfirmButton();
    closeButton.addEventListener('click', closeModal);

    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            closeModal();
        }
    });

    document.querySelectorAll('.product-card').forEach(card => {
        const addToCartBtn = card.querySelector('.add-to-cart-btn');
        addToCartBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const productImage = card.querySelector('.product-image');
            const productTitle = card.querySelector('.product-title');
            const productPrice = card.querySelector('.product-price');

            modalImage.src = productImage.src;
            modalTitle.textContent = productTitle.textContent;

            currentValidityOptions = card.dataset.validities.split(',');
            currentCurrency = card.dataset.currency;
            currentPrices = JSON.parse(card.dataset.prices);

            modalValidity.innerHTML = '';
            currentValidityOptions.forEach(val => {
                const option = document.createElement('option');
                option.value = val;
                option.textContent = val;
                modalValidity.appendChild(option);
            });

            const initialPriceText = productPrice.textContent;
            currentBasePrice = parseFloat(initialPriceText.replace(currentCurrency, '')) ||
                currentPrices[currentValidityOptions[0]]?.[priceFieldMap[currentCurrency] || 'usa'] || 0;

            resetModalState();
            modal.style.display = 'block';
        });
    });
}

document.addEventListener('DOMContentLoaded', async function () {
    console.log('DOMContentLoaded event fired'); // Debugging
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const navMenu = document.getElementById('navMenu');
    const shopItem = document.getElementById('shopItem');
    const moreItem = document.getElementById('moreItem');
    const hamburgerIcon = mobileMenuBtn.querySelector('.hamburger-icon');
    const closeIcon = mobileMenuBtn.querySelector('.close-icon');

    function closeMenu() {
        navMenu.classList.remove('active');
        hamburgerIcon.style.display = 'inline';
        closeIcon.style.display = 'none';
        shopItem.classList.remove('active');
        moreItem.classList.remove('active');
    }

    mobileMenuBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        navMenu.classList.toggle('active');
        if (navMenu.classList.contains('active')) {
            hamburgerIcon.style.display = 'none';
            closeIcon.style.display = 'inline';
        } else {
            closeMenu();
        }
    });

    [shopItem, moreItem].forEach(function (item) {
        item.addEventListener('click', function (e) {
            if (window.innerWidth <= 768) {
                e.preventDefault();
                e.stopPropagation();
                this.classList.toggle('active');
            }
        });
    });

    document.addEventListener('click', function (e) {
        if (!navMenu.contains(e.target)) {
            closeMenu();
        }
    });

    document.querySelectorAll('.nav-item:not(.shop):not(.more)').forEach(function (item) {
        item.addEventListener('click', function () {
            if (window.innerWidth <= 768) {
                closeMenu();
            }
        });
    });

    window.addEventListener('resize', function () {
        if (window.innerWidth > 768) {
            closeMenu();
        }
    });

    document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', function (e) {
            e.preventDefault();
            const href = this.getAttribute('data-href');
            if (href && href !== '#') {
                window.location.href = href;
            }
        });
    });

    document.querySelectorAll('.nav-item[data-href]').forEach(item => {
        item.addEventListener('click', function (e) {
            e.preventDefault();
            const href = this.getAttribute('data-href');
            window.location.href = href;
        });
    });

    document.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', function (e) {
            e.stopPropagation();
            const href = this.getAttribute('href');
            if (href && href !== '#') {
                window.location.href = href;
            }
        });
    });

    document.querySelector('.search-box').addEventListener('click', function (e) {
        e.preventDefault();
        window.location.href = '/shop';
    });

    document.querySelector('.subscribe-btn').addEventListener('click', function () {
        const email = document.querySelector('.newsletter-input').value;
        if (email) {
            alert(`Subscribed with ${email}`);
        } else {
            alert('Please enter a valid email address');
        }
    });

    let slideIndex = 0;
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;

    function showSlide(index) {
        if (index >= totalSlides) slideIndex = 0;
        if (index < 0) slideIndex = totalSlides - 1;
        const offset = -slideIndex * 100;
        document.querySelector('.slider').style.transform = `translateX(${offset}%)`;
    }

    document.querySelector('.slider-prev').addEventListener('click', () => {
        slideIndex--;
        showSlide(slideIndex);
    });

    document.querySelector('.slider-next').addEventListener('click', () => {
        slideIndex++;
        showSlide(slideIndex);
    });

    let slideTimer = setInterval(() => {
        slideIndex++;
        showSlide(slideIndex);
    }, 5000);

    document.querySelector('.slider-container').addEventListener('mouseover', () => clearInterval(slideTimer));
    document.querySelector('.slider-container').addEventListener('mouseout', () => {
        slideTimer = setInterval(() => {
            slideIndex++;
            showSlide(slideIndex);
        }, 5000);
    });

    await fetchSessionId();
    await fetchSocialLinks();
    await fetchCommunityLinks();
    await fetchFreeTrialLinks();
    await fetchTestimonialImages();
    await fetchBestSellers();
});
</script>
</body>

</html>